<!DOCTYPE html>
<html lang="zh">

<head>
      <meta name="google-site-verification" content="3_Og0vGTM1q3fMJ_WjUj2f4vdqlQpD2TS92MVwmgHzQ" />
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="canonical" href="http://lo-tp.github.io/how-to-deal-with-page-specific-javascript-in-rails-program.html" />

    <title>  LOTP's Blog &mdash; How to Deal With Page Specific Javascript in Rails Program
</title>




    <link rel="stylesheet" href="http://lo-tp.github.io/theme/css/style.css">

    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->


    <meta name="author" content="Lotp">
    <meta name="description" content="In recent version of rails, we are introduced a new mechanism of static assets managements. It’s called Asset Pipeline. It is mainly built to improve the performance of our rails programs. By merging all the js and css related files of our programs into a single one, Asset Pipeline ...">
  <meta name="tags" contents="Coffeescript, Ruby, Ruby On Rails, ">
</head>

<body>
<header class="header">
  <div class="container">
      <div class="header-image pull-left">
        <a class="nodec" href="http://lo-tp.github.io"><img src=http://ww3.sinaimg.cn/mw690/005N6Qx8gw1ewt0kld679j305k05kmxk.jpg></a>
      </div>
    <div class="header-inner">
      <h1 class="header-name">
        <a class="nodec" href="http://lo-tp.github.io">LOTP's Blog</a>
      </h1>
      <h3 class="header-text">It's all about Hack, have fun</h3>
      <ul class="header-menu list-inline">
          <li><a class="nodec" href="/tags.html" target="_blank">Tag</a></li>
          <li><a class="nodec" href="/categories.html" target="_blank">Categories</a></li>
      </ul>
    </div>
  </div>
</header> <!-- /.header -->  <div class="container">
  <div class="post full-post">
    <h1 class="post-title">
      <a href="/how-to-deal-with-page-specific-javascript-in-rails-program.html" title="Permalink to How to Deal With Page Specific Javascript in Rails Program">How to Deal With Page Specific Javascript in Rails&nbsp;Program</a>
    </h1>
    <ul class="list-inline">
      <li class="post-date">
        Sat 31 October 2015
        <!-- <a class="text-muted" href="/how-to-deal-with-page-specific-javascript-in-rails-program.html" title="2015-10-31T14:53:00+08:00">Sat 31 October 2015</a> -->
      </li>
      <li class="muted">|</li>
      <li class="post-category">
        <a href="http://lo-tp.github.io/category/learn-ruby.html">Learn Ruby</a>
      </li>
      <li class="muted">|</li>
      <li class="post-tags">
<a href="tag/coffeescript.html"> Coffeescript</a><a href="tag/ruby.html"> Ruby</a><a href="tag/ruby-on-rails.html"> Ruby On Rails</a>      </li>
    </ul>
    <div class="post-content">
      <p>In recent version of rails, we are introduced a new mechanism of static assets managements.
It&#8217;s called <em>Asset Pipeline</em>.</p>
<p>It is mainly built to improve the performance of our rails programs.
By merging all the js and css related files of our programs into a single one, Asset Pipeline could effectively reduce the loading time of our&nbsp;website.</p>
<h3>What&#8217;s The Problem With This&nbsp;Mechanism</h3>
<p>In most cases, it would be necessary for us to have some page specific&nbsp;assets.</p>
<p>For example, in many js files, you would have a line like this <code>$(document).ready(function(){})</code>.
And if all your js files are merged together, then you can only call one <code>$(document).ready()</code>.
This is&nbsp;unacceptable.</p>
<h3>How To Solve This&nbsp;Problem</h3>
<p>A person named <strong>Jason Garber</strong> gave us a solution of using the <span class="caps">HTML5</span>&#8217;s data-* attributes.
I won&#8217;t repeat how he accomplish this, you could see it yourself from <a href="https://viget.com/inspire/extending-paul-irishs-comprehensive-dom-ready-execution">there</a>.
<strong>Jason</strong> solved this problem with pure javascript but we all know that the Rails way is to use&nbsp;coffeescript.</p>
<p>So I refactored <strong>Jason&#8217;s</strong> solution with coffeescript.
And what&#8217;s more is that by using my way, you could organize all your coffeescript in whatever manner you like(You can even put your js code in as many file as you&nbsp;want).</p>
<h3>An Example Telling You All The Steps You Have To Take To Solve This&nbsp;Problem</h3>
<ul>
<li>
<p>You need a brand new rails&nbsp;project.</p>
<p>Run <code>rails new .</code> in an empty&nbsp;directory.</p>
</li>
<li>
<p>Make a new controller named phrases and a new index&nbsp;action.</p>
<p>Run <code>rails g controller phrases index</code>.
Now visit <code>your ip address:3000/phrases/index</code> you&#8217;ll see the default&nbsp;page.</p>
</li>
<li>
<p>Go to <code>app/assets/javascripts</code>, and make a new file named&nbsp;site.coffee.</p>
<p>The content of site.coffee should be like this.
Pay extra attention to the indents, they&#8217;re very&nbsp;important.</p>
</li>
</ul>
<div class="highlight"><pre><span class="l-Scalar-Plain">SITENAME =</span>
  <span class="l-Scalar-Plain">common</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">init</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">-&gt;</span>
    <span class="l-Scalar-Plain">console.log &#39;common&#39;</span>
    <span class="l-Scalar-Plain">return</span>
  <span class="l-Scalar-Plain">phrases:window.phrasesController</span>

<span class="l-Scalar-Plain">UTIL =</span>
  <span class="l-Scalar-Plain">exec</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">(controller, action) -&gt;</span>
    <span class="l-Scalar-Plain">ns = SITENAME</span>
    <span class="l-Scalar-Plain">action = if action == undefined then &#39;init&#39; else action</span>
    <span class="l-Scalar-Plain">if controller != &#39;&#39; and ns[controller] and typeof ns[controller][action] == &#39;function&#39;</span>
      <span class="l-Scalar-Plain">ns[controller][action]()</span>
    <span class="l-Scalar-Plain">return</span>
  <span class="l-Scalar-Plain">init</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">-&gt;</span>
    <span class="l-Scalar-Plain">body = document.body</span>
    <span class="l-Scalar-Plain">controller = body.getAttribute(&#39;data-controller&#39;)</span>
    <span class="l-Scalar-Plain">action = body.getAttribute(&#39;data-action&#39;)</span>
    <span class="l-Scalar-Plain">UTIL.exec &#39;common&#39;</span>
    <span class="l-Scalar-Plain">UTIL.exec controller</span>
    <span class="l-Scalar-Plain">UTIL.exec controller, action</span>
    <span class="l-Scalar-Plain">return</span>
<span class="l-Scalar-Plain">$(document).ready UTIL.init</span>
</pre></div>


<ul>
<li>Open phrases.coffee and append these lines to&nbsp;it.</li>
</ul>
<div class="highlight"><pre><span class="l-Scalar-Plain">window.phrasesController=</span>
    <span class="l-Scalar-Plain">init</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">-&gt;</span>
      <span class="l-Scalar-Plain"># controller-wide code</span>
      <span class="l-Scalar-Plain">console.log &#39;phrases controller&#39;</span>
      <span class="l-Scalar-Plain">return</span>
    <span class="l-Scalar-Plain">index</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">-&gt;</span>
      <span class="l-Scalar-Plain"># action-specific code</span>
      <span class="l-Scalar-Plain">alert(&#39;index&#39;)</span>
      <span class="l-Scalar-Plain">return</span>
</pre></div>


<ul>
<li>
<p>Go to <code>app/views/layouts</code> directory and edit <code>application.html.erb</code>.</p>
<p>Add the following attributes to <code>body</code> tag.</p>
<p><code>data-controller="&lt;%= controller_name %&gt;" data-action="&lt;%= action_name %&gt;"</code></p>
<p>Making it looks like&nbsp;this:</p>
<p><code>&lt;body data-controller="&lt;%= controller_name %&gt;" data-action="&lt;%= action_name %&gt;"&gt;</code></p>
</li>
<li>
<p>Reopen <code>your ip address:3000/phrases/index</code> </p>
<p>You&#8217;ll see an alert pops out saying&nbsp;&#8216;index&#8217;.</p>
<p>Check the console of your&nbsp;browser.</p>
</li>
</ul>
<h3>Explaining</h3>
<ol>
<li>It&#8217;s very clear that in every page, the <code>UTIL.init</code> function would get&nbsp;executed.</li>
<li>In that function, we get informations about the controller and action of the&nbsp;page.</li>
<li>Based on these informations, we invoke the corresponding functions of the specific&nbsp;page.</li>
</ol>
<h3>What&#8217;s the <code>window</code> object&nbsp;for?</h3>
<p>We use the property of the <code>window</code> object to transfer informations in different files. 
It&#8217;s something like a global&nbsp;variable.</p>
<p>Since in coffefscript there is no global variable so I have to use the <code>window</code> object to circumvent this&nbsp;limitation.</p>
    </div>
  </div>
  <hr class="separator">
  <div class="col-md-8 col-md-offset-2">
  </div>
  </div>
<footer class="footer">
  <div class="container">
    <p class="text-center">
      LOTP, <a href="" target="_blank"></a> unless otherwise noted.
    </p>
    <div class="text-center">
      Generated by <a href="http://getpelican.com" target="_blank">Pelican</a> with the <a href="http://github.com/nairobilug/pelican-alchemy">alchemy</a> theme.
    </div>
  </div>
</footer> <!-- /.footer -->
  <script src="http://lo-tp.github.io/theme/js/jquery.min.js"></script>
  <script src="http://lo-tp.github.io/theme/js/bootstrap.min.js"></script>
</body> <!-- 42 -->

</html>